version = 1

[install]
nodejs.pkg-path = "nodejs"

[hook]
on-activate = """
  # Autogenerated by Flox

  # Install nodejs dependencies
  npm install

  # End autogenerated by Flox
"""

[build.quotes-app-nodejs]
command = """
    mkdir -p $out/{libexec,bin}

    npm ci

    # Build the application (creates `./dist`
    npm run build

    # Install `dist` to $out
    cp -r ./dist $out

    # Copy remaining runtime assets
    cp quotes.json $out/dist

    # # This example uses a bundler to create a self-sufficient `dist`
    # # If your app needs additional node_modules at runtime,
    # # `npm prune` and copy the node mudules to $out
    # npm prune --include "prod"
    # cp -r ./node_modules $out

    echo "#!/usr/bin/env sh" >  $out/bin/quotes-app-nodejs
    echo "exec node $out/dist/index.js $@" >> $out/bin/quotes-app-nodejs
    chmod 755 $out/bin/quotes-app-nodejs
"""
description = "A quotes app written in nodejs"
version = "0.0.1"

[build.quotes-app-nodejs-pure]
command = """
   mkdir -p $out/{lib,bin} 
	 cp -pr package.* quotes.json app.js $out/lib
   pushd $out/lib
   npm install --omit=dev
   popd
   echo "#!/usr/bin/env sh" >  $out/bin/quotes-app-nodejs-pure
   echo "exec node $out/lib/app.js" >> $out/bin/quotes-app-nodejs-pure
   chmod 755 $out/bin/quotes-app-nodejs-pure
"""
description = "A quotes app written in nodejs"
version = "0.0.1"
sandbox = "pure"

[services]
quotes-nodejs.command = "npm start"
